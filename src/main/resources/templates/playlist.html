<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FFT Battleground Playlist</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/playlist.css}">
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸŽµ FFT Battleground Playlist</h1>
            <p>Music tracks from <strong>fftbattleground.com</strong></p>
            <div class="status">
                <span class="message-count">Total Songs: <span th:text="${songCount}">0</span></span>
            </div>
        </header>

        <nav class="navigation">
            <a href="/" class="nav-link">Live Chat</a>
            <a href="/playlist" class="nav-link active">Music Playlist</a>
        </nav>

        <main>
            <div class="playlist-container">
                <div class="search-controls">
                    <form method="GET" action="/playlist" class="search-form">
                        <input type="text" name="search" id="song-search" placeholder="Search songs..." 
                               class="search-input" th:value="${searchTerm}">
                        <input type="hidden" name="page" value="0">
                        <input type="hidden" name="size" th:value="${pageSize}">
                        <input type="hidden" name="sortBy" th:value="${sortBy}">
                        <input type="hidden" name="sortDirection" th:value="${sortDirection}">
                        <button type="submit" class="btn btn-primary">Search</button>
                    </form>
                    <div class="filter-buttons">
                        <a th:href="@{/playlist(page=0, size=${pageSize}, sortBy='title', sortDirection='asc', search=${searchTerm})}" 
                           class="filter-btn" th:classappend="${sortBy == 'title' and sortDirection == 'asc'} ? 'active' : ''">Title A-Z</a>
                        <a th:href="@{/playlist(page=0, size=${pageSize}, sortBy='title', sortDirection='desc', search=${searchTerm})}" 
                           class="filter-btn" th:classappend="${sortBy == 'title' and sortDirection == 'desc'} ? 'active' : ''">Title Z-A</a>
                        <a th:href="@{/playlist(page=0, size=${pageSize}, sortBy='duration', sortDirection='asc', search=${searchTerm})}" 
                           class="filter-btn" th:classappend="${sortBy == 'duration' and sortDirection == 'asc'} ? 'active' : ''">Duration â†‘</a>
                        <a th:href="@{/playlist(page=0, size=${pageSize}, sortBy='occurrence', sortDirection='desc', search=${searchTerm})}" 
                           class="filter-btn" th:classappend="${sortBy == 'occurrence' and sortDirection == 'desc'} ? 'active' : ''">Most Played</a>
                        <a th:href="@{/playlist(page=0, size=${pageSize}, sortBy='createdAt', sortDirection='desc', search=${searchTerm})}" 
                           class="filter-btn" th:classappend="${sortBy == 'createdAt' and sortDirection == 'desc'} ? 'active' : ''">Recently Added</a>
                        <a th:href="@{/playlist(page=0, size=${pageSize}, sortBy='updatedAt', sortDirection='desc', search=${searchTerm})}" 
                           class="filter-btn" th:classappend="${sortBy == 'updatedAt' and sortDirection == 'desc'} ? 'active' : ''">Recently Played</a>
                    </div>
                </div>

                <div class="table-container">
                    <table class="playlist-table" id="playlist-table">
                        <thead>
                            <tr>
                                <th class="col-number">#</th>
                                <th class="col-title sortable" data-sort="title">
                                    Song Title 
                                    <span class="sort-arrow" th:classappend="${sortBy == 'title' and sortDirection == 'asc'} ? 'asc' : (${sortBy == 'title' and sortDirection == 'desc'} ? 'desc' : '')">â†•</span>
                                </th>
                                <th class="col-duration sortable" data-sort="duration">
                                    Duration 
                                    <span class="sort-arrow" th:classappend="${sortBy == 'duration' and sortDirection == 'asc'} ? 'asc' : (${sortBy == 'duration' and sortDirection == 'desc'} ? 'desc' : '')">â†•</span>
                                </th>
                                <th class="col-plays sortable" data-sort="occurrence">
                                    Plays 
                                    <span class="sort-arrow" th:classappend="${sortBy == 'occurrence' and sortDirection == 'asc'} ? 'asc' : (${sortBy == 'occurrence' and sortDirection == 'desc'} ? 'desc' : '')">â†•</span>
                                </th>
                                <th class="col-added sortable" data-sort="createdAt">
                                    Added Date 
                                    <span class="sort-arrow" th:classappend="${sortBy == 'createdAt' and sortDirection == 'asc'} ? 'asc' : (${sortBy == 'createdAt' and sortDirection == 'desc'} ? 'desc' : '')">â†•</span>
                                </th>
                                <th class="col-last-played sortable" data-sort="updatedAt">
                                    Last Played 
                                    <span class="sort-arrow" th:classappend="${sortBy == 'updatedAt' and sortDirection == 'asc'} ? 'asc' : (${sortBy == 'updatedAt' and sortDirection == 'desc'} ? 'desc' : '')">â†•</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="song, iterStat : ${songs}" class="song-row" 
                                th:data-title="${song.title}">
                                <td class="track-number" th:text="${(currentPage * pageSize) + iterStat.count}">1</td>
                                <td class="song-title" th:text="${song.title}">Song Title</td>
                                <td class="song-duration" th:text="${song.duration ?: '--:--'}">Duration</td>
                                <td class="song-plays" th:text="${song.occurrence ?: 0}">0</td>
                                <td class="song-added" th:text="${#temporals.format(song.createdAt, 'MMM dd, yyyy')}">Added Date</td>
                                <td class="song-last-played" th:text="${song.occurrence > 0 ? #temporals.format(song.updatedAt, 'MMM dd, yyyy') : 'Never'}">Last Played</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination Controls -->
                <div class="pagination-controls">
                    <div class="pagination-info">
                        <span>Showing <strong th:text="${showingSongs}">0</strong> of <strong th:text="${totalSongs}">0</strong> songs</span>
                        <span>Page <strong th:text="${currentPage + 1}">1</strong> of <strong th:text="${totalPages}">1</strong></span>
                    </div>
                    
                    <div class="pagination-settings">
                        <label for="page-size">Page Size:</label>
                        <select id="page-size" th:value="${pageSize}">
                            <option value="10" th:selected="${pageSize == 10}">10</option>
                            <option value="25" th:selected="${pageSize == 25}">25</option>
                            <option value="50" th:selected="${pageSize == 50}">50</option>
                            <option value="100" th:selected="${pageSize == 100}">100</option>
                            <option value="250" th:selected="${pageSize == 250}">250</option>
                            <option value="500" th:selected="${pageSize == 500}">500</option>
                        </select>
                    </div>
                    
                    <div class="pagination-buttons">
                        <a th:if="${hasPrevious}" 
                           th:href="@{/playlist(page=${currentPage - 1}, size=${pageSize}, sortBy=${sortBy}, sortDirection=${sortDirection}, search=${searchTerm})}" 
                           class="btn btn-secondary">Previous</a>
                        <span th:unless="${hasPrevious}" class="btn btn-disabled">Previous</span>
                        
                        <a th:if="${hasNext}" 
                           th:href="@{/playlist(page=${currentPage + 1}, size=${pageSize}, sortBy=${sortBy}, sortDirection=${sortDirection}, search=${searchTerm})}" 
                           class="btn btn-secondary">Next</a>
                        <span th:unless="${hasNext}" class="btn btn-disabled">Next</span>
                    </div>
                </div>

                <div class="playlist-stats">
                    <div class="stat-card">
                        <h3>Total Tracks</h3>
                        <span class="stat-number" th:text="${totalSongs}">0</span>
                    </div>
                    <div class="stat-card">
                        <h3>Showing</h3>
                        <span class="stat-number" id="showing-count" th:text="${showingSongs}">0</span>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <p>Playlist data fetched from <a href="https://www.fftbattleground.com/fftbg/playlist.xml" target="_blank">FFT Battleground</a></p>
        </footer>
    </div>

    <script th:src="@{/js/playlist.js}"></script>
</body>
</html>